name: Discord Issue All Event Notifier

on:
  issues:
    types: [opened, edited, deleted, transferred, closed, reopened, assigned, unassigned, labeled, unlabeled, milestoned, demilestoned, locked, unlocked]

jobs:
  notify_discord:
    runs-on: ubuntu-latest
    steps:
      # 1ë‹¨ê³„: ì œëª©ê³¼ ìƒ‰ìƒ ë¯¸ë¦¬ ê³„ì‚°
      - name: Prepare dynamic variables
        id: vars
        run: |
          TITLE=$(echo "${{
            (github.event.action == 'opened'    && 'ğŸš¨ ìƒˆë¡œìš´ ì´ìŠˆ ë°œìƒ:') ||
            (github.event.action == 'closed'    && 'âœ… ì´ìŠˆ í•´ê²°:') ||
            (github.event.action == 'reopened'  && 'âš ï¸ ì´ìŠˆ ì¬ê°œ:') ||
            (github.event.action == 'labeled'   && 'ğŸ·ï¸ ë¼ë²¨ ì¶”ê°€:') ||
            (github.event.action == 'unlabeled' && 'ğŸ·ï¸ ë¼ë²¨ ì œê±°:') ||
            (github.event.action == 'assigned'  && 'ğŸ‘¤ ë‹´ë‹¹ì ì§€ì •:') ||
            (github.event.action == 'unassigned' && 'ğŸ‘¤ ë‹´ë‹¹ì í•´ì œ:') ||
            (github.event.action == 'edited'    && 'âœï¸ ì´ìŠˆ ë‚´ìš© ìˆ˜ì •:') ||
            (github.event.action == 'locked'    && 'ğŸ”’ ì´ìŠˆ ì ê¸ˆ:') ||
            (github.event.action == 'unlocked'  && 'ğŸ”“ ì´ìŠˆ ì ê¸ˆ í•´ì œ:') ||
            'âš™ï¸ ì´ìŠˆ ì—…ë°ì´íŠ¸:'
          }} #${{ github.event.issue.number }}")
          
          COLOR=$(echo "${{
            (github.event.action == 'opened'    && 16711680) ||
            (github.event.action == 'closed'    && 65280) ||
            (github.event.action == 'reopened'  && 16761088) ||
            (github.event.action == 'edited'    && 16776960) ||
            4390561
          }}")

          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "color=$COLOR" >> $GITHUB_OUTPUT

      # 2ë‹¨ê³„: 'tsg-adv/discord-webhook-action'ì„ ì‚¬ìš©í•˜ì—¬ ì•Œë¦¼ ì „ì†¡
      - name: Send Discord Issue Notification
        uses: tsg-adv/discord-webhook-action@v5
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "${{ steps.vars.outputs.title }}"
          description: "**ì•¡ì…˜:** ${{ github.event.action }}\n**ì œëª©:** ${{ github.event.issue.title }}\n**ì²˜ë¦¬ì:** ${{ github.event.sender.login }}\n\n[ì´ìŠˆ ë°”ë¡œê°€ê¸°](${{ github.event.issue.html_url }})"
          color: "${{ steps.vars.outputs.color }}"
          timestamp: "${{ github.event.issue.updated_at }}"
