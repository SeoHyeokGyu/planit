name: Discord Issue & Project Notifier

on:
  issues:
    types: [opened, edited, deleted, closed, reopened, assigned, unassigned, labeled, unlabeled, locked, unlocked, milestoned, demilestoned]
  project_card:
    types: [created, moved, converted, deleted]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # ì´ë²¤íŠ¸ íƒ€ì… í™•ì¸
          EVENT_NAME="${{ github.event_name }}"
          
          if [ "$EVENT_NAME" == "issues" ]; then
            # Issues ì´ë²¤íŠ¸ ì²˜ë¦¬
            ACTION="${{ github.event.action }}"
            ISSUE_NUM="${{ github.event.issue.number }}"
            TITLE="${{ github.event.issue.title }}"
            URL="${{ github.event.issue.html_url }}"
            USER="${{ github.event.sender.login }}"
            REPO="${{ github.repository }}"
            
            case $ACTION in
              "opened") EMOJI="ğŸš¨"; MSG="ìƒˆ ì´ìŠˆ"; COLOR=15158332 ;;
              "closed") EMOJI="âœ…"; MSG="ì´ìŠˆ í•´ê²°"; COLOR=3066993 ;;
              "reopened") EMOJI="ğŸ”„"; MSG="ì´ìŠˆ ì¬ê°œ"; COLOR=15105570 ;;
              "labeled") EMOJI="ğŸ·ï¸"; MSG="ë¼ë²¨ ì¶”ê°€"; COLOR=3447003 ;;
              "unlabeled") EMOJI="ğŸ·ï¸"; MSG="ë¼ë²¨ ì œê±°"; COLOR=10070709 ;;
              "assigned") EMOJI="ğŸ‘¤"; MSG="ë‹´ë‹¹ì ì§€ì •"; COLOR=5763719 ;;
              "unassigned") EMOJI="ğŸ‘¤"; MSG="ë‹´ë‹¹ì í•´ì œ"; COLOR=9807270 ;;
              "edited") EMOJI="âœï¸"; MSG="ì´ìŠˆ ìˆ˜ì •"; COLOR=16776960 ;;
              "locked") EMOJI="ğŸ”’"; MSG="ì´ìŠˆ ì ê¸ˆ"; COLOR=7506394 ;;
              "unlocked") EMOJI="ğŸ”“"; MSG="ì ê¸ˆ í•´ì œ"; COLOR=1752220 ;;
              "milestoned") EMOJI="ğŸ¯"; MSG="ë§ˆì¼ìŠ¤í†¤ ì„¤ì •"; COLOR=5793266 ;;
              "demilestoned") EMOJI="ğŸ¯"; MSG="ë§ˆì¼ìŠ¤í†¤ í•´ì œ"; COLOR=10070709 ;;
              "deleted") EMOJI="ğŸ—‘ï¸"; MSG="ì´ìŠˆ ì‚­ì œ"; COLOR=8421504 ;;
              *) EMOJI="ğŸ“Œ"; MSG="ì´ìŠˆ ì—…ë°ì´íŠ¸"; COLOR=3447003 ;;
            esac
            
            curl -X POST "$WEBHOOK_URL" \
              -H "Content-Type: application/json" \
              -d "{
                \"username\": \"GitHub Issues\",
                \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
                \"embeds\": [{
                  \"title\": \"$EMOJI $MSG #$ISSUE_NUM\",
                  \"description\": \"$TITLE\",
                  \"url\": \"$URL\",
                  \"color\": $COLOR,
                  \"fields\": [
                    {
                      \"name\": \"ğŸ“ ì €ì¥ì†Œ\",
                      \"value\": \"$REPO\",
                      \"inline\": true
                    },
                    {
                      \"name\": \"ğŸ‘¤ ì‘ì—…ì\",
                      \"value\": \"$USER\",
                      \"inline\": true
                    }
                  ],
                  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
                }]
              }"
              
          elif [ "$EVENT_NAME" == "project_card" ]; then
            # Project Card ì´ë²¤íŠ¸ ì²˜ë¦¬
            ACTION="${{ github.event.action }}"
            USER="${{ github.event.sender.login }}"
            REPO="${{ github.repository }}"
            CARD_URL="${{ github.event.project_card.url }}"
            
            # ì¹´ë“œ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° (issue ë˜ëŠ” note)
            if [ -n "${{ github.event.project_card.content_url }}" ]; then
              CONTENT_TYPE="Issue"
              # Issue ë²ˆí˜¸ ì¶”ì¶œ (content_urlì—ì„œ)
              ISSUE_NUM=$(echo "${{ github.event.project_card.content_url }}" | grep -oP 'issues/\K\d+')
              TITLE="Issue #$ISSUE_NUM"
            else
              CONTENT_TYPE="Note"
              TITLE="${{ github.event.project_card.note }}"
            fi
            
            case $ACTION in
              "created") 
                EMOJI="â•"
                MSG="í”„ë¡œì íŠ¸ ì¹´ë“œ ì¶”ê°€"
                COLOR=3066993
                DESCRIPTION="ìƒˆë¡œìš´ ì¹´ë“œê°€ í”„ë¡œì íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤"
                ;;
              "moved")
                EMOJI="ğŸ“¦"
                MSG="í”„ë¡œì íŠ¸ ì¹´ë“œ ì´ë™"
                COLOR=5814783
                FROM_COLUMN="${{ github.event.changes.column_id.from }}"
                DESCRIPTION="ì¹´ë“œê°€ ë‹¤ë¥¸ ì»¬ëŸ¼ìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤"
                ;;
              "converted")
                EMOJI="ğŸ”„"
                MSG="ì¹´ë“œ ë³€í™˜"
                COLOR=16776960
                DESCRIPTION="Noteê°€ Issueë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤"
                ;;
              "deleted")
                EMOJI="ğŸ—‘ï¸"
                MSG="í”„ë¡œì íŠ¸ ì¹´ë“œ ì‚­ì œ"
                COLOR=15158332
                DESCRIPTION="ì¹´ë“œê°€ í”„ë¡œì íŠ¸ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤"
                ;;
              *)
                EMOJI="ğŸ“Œ"
                MSG="í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸"
                COLOR=3447003
                DESCRIPTION="í”„ë¡œì íŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤"
                ;;
            esac
            
            curl -X POST "$WEBHOOK_URL" \
              -H "Content-Type: application/json" \
              -d "{
                \"username\": \"GitHub Projects\",
                \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
                \"embeds\": [{
                  \"title\": \"$EMOJI $MSG\",
                  \"description\": \"$DESCRIPTION\n\n**$TITLE**\",
                  \"color\": $COLOR,
                  \"fields\": [
                    {
                      \"name\": \"ğŸ“ ì €ì¥ì†Œ\",
                      \"value\": \"$REPO\",
                      \"inline\": true
                    },
                    {
                      \"name\": \"ğŸ‘¤ ì‘ì—…ì\",
                      \"value\": \"$USER\",
                      \"inline\": true
                    },
                    {
                      \"name\": \"ğŸ“‹ íƒ€ì…\",
                      \"value\": \"$CONTENT_TYPE\",
                      \"inline\": true
                    }
                  ],
                  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
                }]
              }"
          fi
