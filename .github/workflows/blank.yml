name: Discord Issue All Event Notifier

on:
  issues:
    types: [opened, edited, deleted, transferred, closed, reopened, assigned, unassigned, labeled, unlabeled, milestoned, demilestoned, locked, unlocked]

jobs:
  notify_discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          ACTION: ${{ github.event.action }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
          SENDER_LOGIN: ${{ github.event.sender.login }}
          UPDATED_AT: ${{ github.event.issue.updated_at }}
        run: |
          # 1. ìƒí™©ì— ë§ëŠ” ì œëª©ê³¼ ìƒ‰ìƒ ì„¤ì • (ì´ì „ê³¼ ë™ì¼)
          case $ACTION in
            "opened") TITLE="ğŸš¨ ìƒˆë¡œìš´ ì´ìŠˆ ë°œìƒ: #$ISSUE_NUMBER"; COLOR=16711680 ;;
            "closed") TITLE="âœ… ì´ìŠˆ í•´ê²°: #$ISSUE_NUMBER"; COLOR=65280 ;;
            "reopened") TITLE="âš ï¸ ì´ìŠˆ ì¬ê°œ: #$ISSUE_NUMBER"; COLOR=16761088 ;;
            "labeled") TITLE="ğŸ·ï¸ ë¼ë²¨ ì¶”ê°€: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            "unlabeled") TITLE="ğŸ·ï¸ ë¼ë²¨ ì œê±°: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            "assigned") TITLE="ğŸ‘¤ ë‹´ë‹¹ì ì§€ì •: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            "unassigned") TITLE="ğŸ‘¤ ë‹´ë‹¹ì í•´ì œ: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            "edited") TITLE="âœï¸ ì´ìŠˆ ë‚´ìš© ìˆ˜ì •: #$ISSUE_NUMBER"; COLOR=16776960 ;;
            "locked") TITLE="ğŸ”’ ì´ìŠˆ ì ê¸ˆ: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            "unlocked") TITLE="ğŸ”“ ì´ìŠˆ ì ê¸ˆ í•´ì œ: #$ISSUE_NUMBER"; COLOR=4390561 ;;
            *) TITLE="âš™ï¸ ì´ìŠˆ ì—…ë°ì´íŠ¸: #$ISSUE_NUMBER"; COLOR=4390561 ;;
          esac

          # 2. ì„¤ëª… í…ìŠ¤íŠ¸ ì¤€ë¹„
          DESCRIPTION=$(printf '**ì•¡ì…˜:** %s\n**ì œëª©:** %s\n**ì²˜ë¦¬ì:** %s\n\n[ì´ìŠˆ ë°”ë¡œê°€ê¸°](%s)' "$ACTION" "$ISSUE_TITLE" "$SENDER_LOGIN" "$ISSUE_URL")

          # 3. jqë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ JSON í˜ì´ë¡œë“œ ìƒì„±
          # jqê°€ ëª¨ë“  íŠ¹ìˆ˜ë¬¸ì(ì¤„ë°”ê¿ˆ, ë”°ì˜´í‘œ ë“±)ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤ë‹ˆë‹¤.
          JSON_PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$DESCRIPTION" \
            --argjson color "$COLOR" \
            --arg timestamp "$UPDATED_AT" \
            '{embeds: [{title: $title, description: $description, color: $color, timestamp: $timestamp}]}')

          # 4. curlë¡œ ì›¹í›… ì „ì†¡
          curl -X POST -H "Content-Type: application/json" -d "$JSON_PAYLOAD" "$DISCORD_WEBHOOK_URL"
