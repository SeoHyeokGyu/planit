services:
  # Spring Boot API 서버
  - type: web
    name: planit-api
    runtime: docker
    region: singapore  # 또는 oregon (미국 서부)
    plan: free  # free, starter, standard, pro
    branch: main
    dockerfilePath: ./Dockerfile
    envVars:
      # Spring Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod

      # Database (Render PostgreSQL 연결)
      - key: DATABASE_URL
        fromDatabase:
          name: planit-db
          property: connectionString

      # JWT Secret (Render Secret에서 생성)
      - key: JWT_SECRET
        generateValue: true
        sync: false

      # Google Maps API
      - key: GOOGLE_MAPS_API_KEY
        sync: false

      # Weather API
      - key: WEATHER_API_KEY
        sync: false

    # 헬스 체크
    healthCheckPath: /api/health

    # 자동 배포 설정
    autoDeploy: true

    # 빌드 명령어 (Dockerfile 사용 시 필요 없음)
    # buildCommand: ./gradlew clean build -x test

    # 시작 명령어 (Dockerfile에서 정의)
    # startCommand: java -jar build/libs/planit-0.0.1-SNAPSHOT.jar

  # PostgreSQL 데이터베이스
  - type: pserv
    name: planit-db
    runtime: postgresql
    region: singapore
    plan: free  # free는 90일 후 만료됨, starter는 월 $7
    databaseName: planit
    databaseUser: planit
    ipAllowList: []  # 빈 배열 = 모든 IP 허용

  # Redis (선택사항 - Render에서 Redis는 유료)
  # 무료 대안: Upstash Redis 사용 권장
  # - type: redis
  #   name: planit-redis
  #   region: singapore
  #   plan: starter  # 최소 $10/month
  #   maxmemoryPolicy: allkeys-lru
  #   ipAllowList: []
