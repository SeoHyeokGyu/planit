services:
  # Spring Boot API 서버
  - type: web
    name: planit-api
    runtime: docker
    region: singapore  # 또는 oregon (미국 서부)
    plan: free  # free, starter, standard, pro
    branch: main
    dockerfilePath: ./Dockerfile
    envVars:
      # Spring Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod

      # Database (Neon PostgreSQL 연결)
      - key: DATABASE_URL
        sync: false

      # JWT Secret (Render에서 자동 생성)
      - key: JWT_SECRET
        generateValue: true

      # Google Maps API
      - key: GOOGLE_MAPS_API_KEY
        sync: false

      # Weather API
      - key: WEATHER_API_KEY
        sync: false

      # Redis (Upstash)
      - key: REDIS_HOST
        sync: false
      - key: REDIS_PORT
        value: "6379"
      - key: REDIS_PASSWORD
        sync: false

    # 헬스 체크
    healthCheckPath: /api/health

    # 자동 배포 설정
    autoDeploy: true

    # 빌드 명령어 (Dockerfile 사용 시 필요 없음)
    # buildCommand: ./gradlew clean build -x test

    # 시작 명령어 (Dockerfile에서 정의)
    # startCommand: java -jar build/libs/planit-0.0.1-SNAPSHOT.jar

  # Next.js 프론트엔드
  - type: web
    name: planit-frontend
    runtime: node
    region: singapore
    plan: free
    branch: main
    rootDir: frontend
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      # API URL (백엔드 서비스 URL)
      - key: NEXT_PUBLIC_API_URL
        value: https://planit-api-y2ie.onrender.com
    autoDeploy: true
